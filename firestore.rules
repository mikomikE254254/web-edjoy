/**
 * This ruleset enforces a security model for a retail product catalog.
 *
 * Core Philosophy:
 * The primary goal is to allow any user to browse the catalog freely while enabling
 * administrators to manage products during development. Write access is currently
 * open for prototyping purposes and MUST be secured before production.
 *
 * Data Structure:
 * - /products/{productId}: Stores individual product details.
 * - /categories/{categoryId}: Stores category information.
 * This flat structure is performant and simplifies security rules.
 *
 * Key Security Decisions:
 * - Public Read Access: All documents in both `/products` and `/categories` are publicly
 *   readable and listable to allow the app's front-end to function for all visitors.
 * - Open Write Access (Products): For development, all write operations on the `/products`
 *   collection are allowed (`if true;`). This enables the admin dashboard to function
 *   without a full authentication system. This is insecure and must be replaced with
 *   role-based access control before launch.
 * - Category Writes Disabled: Write access to `/categories` remains disabled, as there
 *   is currently no UI to manage them.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description
     *   Rules for the top-level product catalog. Products are public and can be read by anyone.
     *   Write access is currently open for prototyping.
     * @path
     *   /products/{productId}
     * @allow
     *   Any user can read product details and list products. (get, list)
     * @allow
     *   Any user can create, update, and delete products for development purposes. (create, update, delete)
     * @principle
     *   Prototyping Flexibility over Security. This rule is intentionally permissive to
     *   facilitate rapid development. It MUST be secured before production.
     */
    match /products/{productId} {
      allow get: if true;
      allow list: if true;

      // WARNING: Open write access for prototyping.
      // These rules allow any user to create, update, or delete products.
      // This is for development convenience and MUST be secured before production
      // by implementing proper authentication and authorization checks.
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }

    /**
     * @description
     *   Rules for product categories. Categories are public and read-only.
     * @path
     *   /categories/{categoryId}
     * @allow
     *   Any user can list all available categories. (get, list)
     * @deny
     *   All write operations are denied as there is no admin system for categories.
     * @principle
     *   Public Read-Only Data. This rule ensures categories are viewable by all,
     *   while writes are locked down for security.
     */
    match /categories/{categoryId} {
      allow get: if true;
      allow list: if true;

      // CRITICAL: Cannot implement owner-only or admin-only writes. The 'Category' entity is missing an 'ownerId' or role-based field.
      // All write operations are disabled to prevent unauthorized data modification.
      allow create: if false; // TODO: Add admin validation once an admin role system is implemented.
      allow update: if false; // TODO: Add admin validation once an admin role system is implemented.
      allow delete: if false; // TODO: Add admin validation once an admin role system is implemented.
    }
  }
}
