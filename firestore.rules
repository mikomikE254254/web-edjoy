/**
 * This ruleset enforces a security model for a retail product catalog.
 *
 * Core Philosophy:
 * The primary goal is to allow any user to browse the catalog freely while enabling
 * administrators to manage products during development. Write access is currently
 * open for prototyping purposes and MUST be secured before production.
 *
 * Data Structure:
 * - /products/{productId}: Stores individual product details.
 * - /products/{productId}/reviews/{userId}: Stores user-specific ratings.
 * - /categories/{categoryId}: Stores category information.
 * - /styles/{styleId}: Stores style information.
 * This flat structure is performant and simplifies security rules.
 *
 * Key Security Decisions:
 * - Public Read Access: All documents are publicly readable to allow the app's front-end
 *   to function for all visitors.
 * - Open Write Access (for Prototyping): For development, write operations on products,
 *   categories, and styles are allowed (`if true;`). This is insecure and must be
 *   replaced with role-based access control before launch.
 * - Owner-Only Review Writes: Users can only write to their own review document.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /products/{productId} {
      allow read: if true;
      allow write: if true; // WARNING: Open write access for prototyping.

      match /reviews/{userId} {
        allow read: if true;
        allow write: if request.auth != null && request.auth.uid == userId;
      }
    }

    match /categories/{categoryId} {
      allow read: if true;
      // Allow writes for admin to add new categories during development
      allow write: if true;
    }
    
    match /styles/{styleId} {
      allow read: if true;
      // Allow writes for admin to add new styles during development
      allow write: if true;
    }
  }
}
